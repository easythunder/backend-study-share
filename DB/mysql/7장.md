# 7장

## MySQL 암호화 한 페이지 요약 (Real MySQL 8.0 7장)

### 1) 어디에서 암호화할까? (앱 vs DB)

- **응용프로그램(컬럼 단위) 암호화**
    - 주민번호/계좌번호처럼 **특정 컬럼만 선택적으로** 암호화할 때 유리
    - 단, 암호화된 값은 **원본 기준 정렬·범위 검색이 어려워** 인덱스를 100% 활용 못할 수 있음
    - 특히 `BETWEEN ... AND`, `ORDER BY ... LIMIT` 같은 패턴에서 제약이 큼

- **데이터베이스(테이블 단위) 암호화**
    - MySQL 자체에서 **테이블 단위로 암호화**
    - 보안 감사에서 자주 요구되며, 서비스에 따라 **앱 암호화 + DB 암호화(이중 암호화)** 를 쓰기도 함
        
        ---
        

### 2) TDE란? (Transparent Data Encryption / Data at Rest)

- MySQL의 TDE는 **메모리나 네트워크 전송 구간이 아니라, 디스크에 저장/읽기(I/O) 구간에서만** 암·복호화가 발생
- 그래서 쿼리 처리 과정에서는 “암호화 테이블인지”를 크게 신경 쓰지 않아도 되는 **투명(Transparent) 암호화** 방식

---

### 3) 키 관리 구조 (Keyring + 2단계 키)

- TDE 키는 **키링(KeyRing) 플러그인**이 관리
- **MySQL 8.0 커뮤니티 에디션은 `keyring_file`만 사용 가능**(다른 플러그인은 엔터프라이즈)
- 키 관리는 공통적으로 **2단계(2-Tier)** 구조
    - **마스터 키(Master Key)**
        - 테이블스페이스 키를 암호화하는 키
        - KMS/Vault 또는 파일 형태로 보관, **외부 노출 가능성 → 주기적 교체 필요**
    - **테이블스페이스 키(Tablespace Key / Private Key)**
        - 실제 테이블 데이터를 암호화하는 키
        - 마스터 키로 암호화되어 **데이터 파일 헤더에 저장**
        - 바꾸면 테이블 데이터를 **전부 재암호화**해야 해서 부하가 커짐 → 주기적 변경이 비권장

---

### 4) 알고리즘 & 성능 포인트

- MySQL TDE는 **AES-256만 지원**
- 성능 영향은 “항상”이 아니라 **디스크 I/O가 발생할 때만** 추가 비용이 생김
    - **읽기 지연**: 버퍼풀에 없어서 디스크에서 읽어올 때 **복호화 비용** 추가
    - **쓰기 지연**: 디스크로 플러시할 때 **암호화 비용**이 있지만, 보통 **백그라운드 쓰레드**로 처리되어 사용자 쿼리 시간에 직접 큰 영향이 덜할 수 있음