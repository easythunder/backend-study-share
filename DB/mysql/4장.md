# 4장

## 1. MySQL 전체 구조

- MySQL은 **MySQL 엔진(쿼리 처리)** + **스토리지 엔진(데이터 저장)** 구조로 구성됨.
- SQL 실행 흐름:
    
    **파싱 → 전처리 → 옵티마이저 → 실행 엔진 → 스토리지 엔진 → 디스크 I/O**
    

## 2. 파싱(Parsing)

- SQL을 토큰(token)으로 분리하고 파서 트리(parse tree) 생성.
- 문법 체크 및 유효성 검사.
- token의 구성요소는 총 6개이다.
  1) 키워드_keyword / SQL 문법에서 의미가 고정된 예약어 Ex) SELECT, FROM, WHERE
  2) 식별자_Identifier / 사용자가 정의한 객체 이름 Ex) 테이블명, 컬럼명, DB명
  3) 리터럴_Literal / 값 그 자체를 의미하는 토큰 Ex) 'hello', '2025-12-02'
  4) 연산자_Operator / 산술 비교 논리에 사용되는 기호 Ex) + - * /
  5) 구분자_Separator / SQL 문장의 구조를 나누는 특수 문자 Ex) , () ;
  6) 주석_comment / 파싱 될때는 무시되지만 토큰 분리 과정에서 인식됨 Ex) -- , /* */ 

## 3. 옵티마이저(Optimizer)

- 여러 실행 계획을 비교하고 비용(cost) 기반으로 최적의 실행 계획 선택.
- MySQL 성능의 핵심 요소.

## 4. 실행 엔진 & 핸들러(Handler)

- 실행 엔진이 스토리지 엔진에 작업 요청.
- 스토리지 엔진은 실제 레코드 읽기/쓰기 수행.

## 5. 스토리지 엔진 – InnoDB

MySQL 8.0의 기본 스토리지 엔진.

### (1) 클러스터링 인덱스

- 기본 키(PK) 순서대로 레코드를 저장.
- PK 조회 및 범위 검색이 빠름.
- 세컨더리 인덱스는 실제 주소 대신 PK를 저장 → PK 재조회 필요.

### (2) 외래 키 지원

- 참조 무결성 보장.
- 하지만 락·데드락 위험 증가 → 운영에서는 자주 비활성화함.

### (3) MVCC & 버퍼 풀

- MVCC로 **잠금 없는 읽기(consistent read)** 지원.
- 버퍼 풀(buffer pool)은 데이터와 인덱스를 메모리에 캐싱해 I/O 감소.

### (4) 리두 로그 & 더블라이트 버퍼

- 리두 로그: WAL 방식으로 장애 복구 보장.
- Double Write Buffer: 디스크 쓰기 안정성 향상.

### (5) 체인지 버퍼

- 인덱스 업데이트를 지연 처리해 디스크 I/O 감소.
- UNIQUE 인덱스는 중복 확인 필요 → 사용 불가.

## 6. 스레드 구조

- 포그라운드 스레드: 클라이언트 연결 처리, 쿼리 실행.
- 백그라운드 스레드:
    - 버퍼풀 플러시
    - 리두/언두 로그 작업
    - 인서트 버퍼 병합
    - 락/데드락 관리 등.

## 7. 메모리 구조

- **글로벌 메모리**: 버퍼풀, 테이블 캐시, 로그 버퍼 등.
- **로컬 메모리**: 정렬 버퍼, 조인 버퍼, 세션별 버퍼.