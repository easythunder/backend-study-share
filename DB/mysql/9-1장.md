# 9-1장 (Optimizer)

# 옵티마이저(Optimizer) 정리

## 1) 옵티마이저란?

- MySQL 서버로 들어온 쿼리는 **결과는 같아도 실행 방법(접근 경로/조인 순서 등)은 여러 가지**가 가능함
- 이 중 가장 효율적인 실행 계획(Execution Plan)을 선택하는 역할이 **옵티마이저(Optimizer)**

> 실행 계획 확인: EXPLAIN
- 옵티마이저를 실행하는 엔진은 따로 존재하지 않고 MySQL 서버 (SQL 레이어, MySQㅣ엔진)안에서 쿼리를
처리하는 스레드가 옵티마이저 코드를 호출해서 실행합니다.

---

## 2) 쿼리 실행 절차 (3단계)

1. **SQL 파서(Parser)**
    - SQL 문장을 분석/분해하여 **SQL 파스 트리(Parse Tree)** 생성
2. **옵티마이저(Optimizer)**
    - 파스 트리를 기반으로 **실행 계획 수립**
3. **MySQL 엔진 + 스토리지 엔진**
    - 실행 계획에 따라 스토리지 엔진에서 데이터를 읽고 처리

---

## 3) 기본 데이터 처리

### 3-1) 리드 어헤드(Read Ahead)

- 앞으로 필요할 데이터를 예측해 **미리 디스크에서 읽어 버퍼 풀(Buffer Pool)에 적재**하는 동작
- 예시 흐름
    - 풀 테이블 스캔 시작 시 초기 일부 페이지는 **포그라운드 스레드**가 읽음
    - 이후 특정 시점부터 읽기 작업을 **백그라운드 스레드**로 넘김
    - 백그라운드 스레드는 한 번에 **4개 또는 8개 페이지**를 읽어 버퍼 풀에 저장(읽는 페이지 수는 점점 증가)
    - 포그라운드 스레드는 버퍼 풀의 준비된 데이터를 사용 → 처리 속도 향상
- 주로 사용되는 경우: **풀 테이블 스캔, 풀 인덱스 스캔**

---

### 3-2) 풀 테이블 스캔(Full Table Scan)

- 테이블을 처음부터 끝까지 전부 읽는 방식
- 발생/선택되는 대표 상황
    - 테이블 레코드 수가 적어서 **인덱스 사용보다 빠른 경우**
    - `WHERE` / `ON` 절에 **인덱스를 사용할 수 있는 조건이 없는 경우**
    - 옵티마이저가 판단한 **예상 조회 건수가 너무 많아** 인덱스 활용이 비효율적인 경우

---

### 3-3) 풀 인덱스 스캔(Full Index Scan)

- 인덱스를 처음부터 끝까지 전부 스캔하는 방식

---

### 3-4) 병렬 처리(Parallel)

- 하나의 쿼리를 **여러 스레드로 나누어 처리**하는 방식
- 조건 없이 단순히 **전체 건수 조회** 같은 쿼리만 병렬 처리 가능